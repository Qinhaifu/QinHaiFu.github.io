<!DOCTYPE html><html lang="cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>《Scaling Tools for Millions of Assets for 'Horizon Forbidden West'》观后感 | 仲谨的个人博客</title><meta name="author" content="仲谨(haifu_qin@163.com)"><meta name="copyright" content="仲谨(haifu_qin@163.com)"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="《Scaling Tools for Millions of Assets for &#39;Horizon Forbidden West&#39;》观后感。">
<meta property="og:type" content="article">
<meta property="og:title" content="《Scaling Tools for Millions of Assets for &#39;Horizon Forbidden West&#39;》观后感">
<meta property="og:url" content="http://qinhaifu.github.io/2024/05/26/GDC/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/index.html">
<meta property="og:site_name" content="仲谨的个人博客">
<meta property="og:description" content="《Scaling Tools for Millions of Assets for &#39;Horizon Forbidden West&#39;》观后感。">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-05-26T09:37:38.000Z">
<meta property="article:modified_time" content="2024-05-26T07:42:37.000Z">
<meta property="article:author" content="仲谨(haifu_qin@163.com)">
<meta property="article:tag" content="GDC2023">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://qinhaifu.github.io/2024/05/26/GDC/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '《Scaling Tools for Millions of Assets for \'Horizon Forbidden West\'》观后感',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-26 15:42:37'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="仲谨的个人博客"><span class="site-name">仲谨的个人博客</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">《Scaling Tools for Millions of Assets for 'Horizon Forbidden West'》观后感</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-05-26T09:37:38.000Z" title="Created 2024-05-26 17:37:38">2024-05-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-05-26T07:42:37.000Z" title="Updated 2024-05-26 15:42:37">2024-05-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/GDC2023/">GDC2023</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="《Scaling Tools for Millions of Assets for 'Horizon Forbidden West'》观后感"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>前段时间看了Guerrilla工作室在2023年的GDC演讲，《Scaling Tools for Millions of Assets for ‘Horizon Forbidden West’》</p>
<p>简单做一下笔记，记录自己的收获与一些思考，有任何疑问欢迎找我讨论。</p>
<p>本次研究总结下来其实就是在介绍三个东西，分别是Asset Indexer、Global Store还有Virtual File System，他们将这三个东西结合之后，解决了项目中资源量日益膨胀导致开发效率低下的问题。</p>
<p>下面我将分别讲述我对这三部分的理解。</p>
<h1 id="一、Asset-DataBase（资产数据库）"><a href="#一、Asset-DataBase（资产数据库）" class="headerlink" title="一、Asset DataBase（资产数据库）"></a>一、Asset DataBase（资产数据库）</h1><h2 id="1、背景"><a href="#1、背景" class="headerlink" title="1、背景"></a>1、背景</h2><h3 id="1-1、Asset-Browser（资源搜索、过滤）"><a href="#1-1、Asset-Browser（资源搜索、过滤）" class="headerlink" title="1.1、Asset Browser（资源搜索、过滤）"></a>1.1、Asset Browser（资源搜索、过滤）</h3><p>假设我们有这样一个场景，你在使用场景编辑器或者关卡编辑器，你希望能看到所有的能放置到场景中的资源，同时你希望能够通过一些关键字（filter）去过滤搜索符合条件的资源。</p>
<p>这是资产浏览器（Asset Browser）中普通而且很基础的功能，这个功能可以使得设计师能够更好的管理和利用自己的资源，如下图。<br><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/1.jpg"></p>
<h3 id="1-2、Reference-Viewer（资源引用关系查看）"><a href="#1-2、Reference-Viewer（资源引用关系查看）" class="headerlink" title="1.2、Reference Viewer（资源引用关系查看）"></a>1.2、Reference Viewer（资源引用关系查看）</h3><p>但是有些时候，我们可能还想知道，”这个资产是否被使用过“、“这个资产被用在了什么地方”，这两个问题只有在获得了所有资产的信息的情况下才能有一个准确的答案。</p>
<p>这就需要一个好用的引用查看器（Reference Viewer），一个好的Reference Viewer可以提供与特定资产存在关联关系的所有位置的完整的列表，如下图。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/2.jpg"></p>
<h2 id="2、Asset-Indexer"><a href="#2、Asset-Indexer" class="headerlink" title="2、Asset Indexer"></a>2、Asset Indexer</h2><h3 id="2-1、Asset-Indexer简介"><a href="#2-1、Asset-Indexer简介" class="headerlink" title="2.1、Asset Indexer简介"></a>2.1、Asset Indexer简介</h3><p>在制作《地平线西部禁区》之前，Guerrilla工作室使用了一个基于SQLite Database的数据库方案，这个方案可以满足资源浏览的需求（Asset Browser），虽然会有一点慢，而且有一点点的不可靠，比如数据丢失之类的问题&#x3D;。&#x3D;………但是基本上是可以用的。</p>
<p>现在他们有了更多的需求，比如上面说到的资源引用关系查看（Asset Reference Viewer）,他们以前的数据库就没有办法满足。</p>
<p>于是他们希望能够迭代他们以前的Asset Database，他们希望能够制作一款同时满足Asset Browser和Asset Reference Viewer需求的数据库。</p>
<p>【注：这里我的理解是，要实现Asset Browser和Asset Reference Viewer这两种功能，都依赖了Asset Database，而以前的SQLite的方案无法满足需求，于是他们决定了定制】</p>
<p>Asset Indexer，是一个本地的数据库（Local DataBase），能够支持索引上亿的文件，允许在不打开原文件的情况下获取文件的信息。这是一个运行在每一个工作站（workstatio）扫描用户的磁盘然后监控文件修改的服务。</p>
<p>任何想要了解文件、对象或对象之间连接的工具都会向这个数据库查询，这包括我们的编辑器、DCC软件包、Python脚本，甚至游戏本身。</p>
<h3 id="2-2、Asset-Indexer实现方式简介"><a href="#2-2、Asset-Indexer实现方式简介" class="headerlink" title="2.2、Asset Indexer实现方式简介"></a>2.2、Asset Indexer实现方式简介</h3><p>他们使用了一种CoreText 文件描述资产信息，这是一种类似 JSON 的文本格式。</p>
<p>下面用环境探针（Environment Probes）作为例子，有一个名为 Probes.CoreText 的 CoreText 文件。</p>
<p>（1）每个 CoreText 文件包含多个对象块。【下图中有一个对象块，EnvironmentProbe】</p>
<p>（2）对象块以类型名开始，而且这个类型名与我们在 C++ 代码中公开的类相匹配，以便在运行时创建实例。【比如下图中就是EnvironmentProbe】</p>
<p>（3）每个对象都应该有一个 UUID 和一个Name。【资产UUID和资产Name】</p>
<p>（4）接下来是特定于类型的属性，比如EnvironmentProbe对象的类型是DynamicLighting和变换信息Orientation。</p>
<p>（5）所有属性值都以字符串形式存储。</p>
<p>（6）有指向其他对象的链接，这些链接使用尖括号语法与其他属性区分开来，比如下图中的DepthTexture、DynamicAlbedoTexture、DynamicNormalTexture，这些就是其他对象。这些纹理对象存储在它们自己的文件中。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/3.jpg"></p>
<p><em><strong>跟着索引链接来看“DynamicAlbedoTexture”对应的Probel_albedo.CoreText</strong></em></p>
<p>跟踪到EnvironmentProbe_albedo.CoreText 的链接，我们再次看到对象的类型名， UUID 和对象名称，一些纹理设置，如压缩格式和分辨率，同样以字符串形式存储，最后是指向包含实际数据的 dds 文件的链接最后的DDSFile。</p>
<p>指向资产文件的链接与对象链接不同的链接格式，这里使用的是反引号。【这样能够区分CoreText对象和资产文件】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/4.jpg"></p>
<p>有了CoreText的这些描述属性之后，能干什么呢？演讲者举了一个例子。</p>
<p>例如，尝试在他们的Game_Assets文件夹中找到所有的EnvironmentProbes。在2.8毫秒内，我们找到了所有3721个Environment Probes。</p>
<p>或者让我们找到所有对象和文件名中都包含Main Quest 2的对象，在16毫秒内找到了17000个对象。</p>
<p>能够这么快的另一个原因是数据库的大小从25GB缩小到了5GB，能够直接缓存在内存中。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/5.jpg"></p>
<p>为了更进一步的压缩数据量，他们将路径字符串拆分，并放在一个缓存列池中，然后一依靠索引去表达完整的路径。</p>
<p>【因为字符串占用的字节数远远多于一个索引，这其实和一些压缩算法很相似了】</p>
<h3 id="2-2、总结一下"><a href="#2-2、总结一下" class="headerlink" title="2.2、总结一下"></a>2.2、总结一下</h3><p>（1）因为自定义了文件描述信息格式以及数据库，所以他们使用了特定的数据集创建创建自定义的加速表。</p>
<p>（2）因为数据压缩之后，数据量非常少，可以直接读取进入内存中，读取的速度非常快。</p>
<p>（3）默认将所有的查询实现都是批处理和多线程的方式</p>
<p>（4）存储文件系统的属性，如修改时间、文件大小和哈希值，因此不需要访问磁盘就能获取这些信息</p>
<p>（5）在监视磁盘上的更改方面，之前使用了Windows的ReadDirectoryChanges API。但是现在直接使用文件系统的NTFS USN Journal，因为它更可靠。</p>
<p>能够检查数据库是否处理了所有磁盘I&#x2F;O，并在Asset Indexer未运行时回放发生的任何活动，而无需重新扫描整个项目。</p>
<h1 id="二、内容加载（Content-Loading）GlobalStore"><a href="#二、内容加载（Content-Loading）GlobalStore" class="headerlink" title="二、内容加载（Content Loading）GlobalStore"></a>二、内容加载（Content Loading）GlobalStore</h1><p>开发过程中除了在工具中进行资源的检索、预览，还有另一个重要部分是将内容加载到游戏中。</p>
<p>【下图是Guerrilla工作室各个作品的大小，真的是越来越大】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/6.jpg"></p>
<p>游戏包体的大小越来越大，增长的速率也越来越高，几乎超出了PS5蓝光光盘的容量，而且这个95GB是供消费者使用的游戏包；开发包还要更大，因为它还包含很多的调试数据。</p>
<p>演讲者介绍了他们如何完全重新设计了开发过程中的内容加载方式，并且现在可以在20秒内启动任何构建。【开发过程的加载方式】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/7.jpg"></p>
<p>首先对这个系统进行一点历史回顾，从《Horizon Zero Dawn》之前开始，安装一个超过100GB的包对于迭代时间来说是非常糟糕的。</p>
<p>生成包需要大约一个小时，安装需要另外30分钟。等待1.5个小时来测试您在开发套件上的更改是不可接受的。</p>
<h2 id="1、拆分整包"><a href="#1、拆分整包" class="headerlink" title="1、拆分整包"></a>1、拆分整包</h2><p>在开发过程中，游戏并不是从已安装的整包中加载，而是逐个加载内容的各个部分，随着逐渐细化粒度，迭代速度会变得更快。</p>
<p>然后他们直接按照每个CoreText文件的粒度进行迭代。</p>
<p>【简单点的解释就是，将整包拆分，那么迭代的时候只需要重写生成一个小的包体，而不是整包，这能缩短生成包体的时间。】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/8.jpg"></p>
<p>比如说想要更改纹理压缩设置，那么只需要将CoreText文件重新处理就好，不需要将整个游戏包体重新处理。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/9.jpg"></p>
<p>PS4的devkits采用了老式的旋转硬盘，读写速度非常慢，因此他们没有将这些结果复制到硬盘上，而是通过网络从workstation的固态硬盘流式传输到运行在devkits上的游戏中。【按照他们的测算应该是网络传输比老式旋转硬盘读取的速度更快】</p>
<p>【注：google了一下PS4 devkit，因为主机游戏运行在特定的设备比如PS4或Xbox，这类属于游戏的专属硬件，和PC完全不同，而devkit则可以简单地理解为主机与PC之间的桥梁，或者你可以理解为就是一个PS4游戏的专属的的调试运行环境，那么这里我们就可以把workstation理解为个人开发电脑之类的角色】</p>
<p>使用这种方式他们达到了每秒1Gbit的网络速度，这是PS4能够达到的最快速度。</p>
<h2 id="2、缓存转换结果，网络共享"><a href="#2、缓存转换结果，网络共享" class="headerlink" title="2、缓存转换结果，网络共享"></a>2、缓存转换结果，网络共享</h2><p>即使使用了网络传输的方式，依然花费了很多时间在工作站上将CoreText转换成二进制格式，这涉及到纹理压缩、着色器编译、音频压缩等等，这些都需要很长时间。【我的理解是：因为每次有资源更新都需要个人的workstation进行重新的资源转换，每个人都在迭代不同的内容，那么每个人在更新的时候就需要compress很多的东西】</p>
<p>在他们将包体拆成很多小包体的前提下，大多数人只编辑内容的一小部分，那么他们就可以将结果缓存到网络共享（network share）中，用户的workstation只需从共享位置下载已经转换好的内容，然后流式传输到游戏中。</p>
<p>【当network share中已经存在转换过后的结果，workstation就不需要进行compress了，直接拉取结果到本地更快。】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/10.jpg"></p>
<p>在《Horizon Zero Dawn》的开发期间，他们使用了这样的方式。</p>
<p>经过验证，这是一个完全可行的解决方案，共享了所有繁重的CPU工作并缓存了结果（资源转换是重CPU的，就像你编译引擎）。</p>
<p>并且使用网络传输的方式，不需要将任何内容存储在缓慢的PS4硬盘上。</p>
<p>但是！他们觉得这仍然不够快！【wow，真是有追求的技术大佬】</p>
<p>在同步到最新版本后，您需要在加载游戏之前花费15分钟将所有新转换的内容下载到workstation上。【因为这个时候还是从network share下载到workstation的SSD上，然后再通过网络传输给devkits】</p>
<p>如之前所提到的，文件系统不喜欢许多小文件，而网络文件共享对此更加糟糕。</p>
<p>与本地文件系统相比，SMB共享中读取小文件只能达到大约700个文件&#x2F;秒，而本地文件系统可以达到25000个文件&#x2F;秒。</p>
<p>网络堆栈完全有能力完成这项工作，因此我们在2015年进行了一些测试，尝试了Windows上的SMB、Linux上的Apache和专用硬件，但都未达到我们的期望。</p>
<p>因此，在这种情况下，他们决定自行开发了解决方案。</p>
<h2 id="3、GlobalStore替代SMB共享服务器"><a href="#3、GlobalStore替代SMB共享服务器" class="headerlink" title="3、GlobalStore替代SMB共享服务器"></a>3、GlobalStore替代SMB共享服务器</h2><h3 id="3-1、替换服务器"><a href="#3-1、替换服务器" class="headerlink" title="3.1、替换服务器"></a>3.1、替换服务器</h3><p>GlobalStore是一个In-memory Key-Value Store，通过简单的get&#x2F;put协议进行访问，将其视为网络连接的哈希映射，而不是文件系统。</p>
<p>它在Windows上运行，并且通过使用I&#x2F;O完成端口和直接内存访问来对网络传输数据进行高度优化，通过流水线请求进行操作。</p>
<p>对于小型读取操作，其速度比NVMe上的NTFS快大约3倍。</p>
<p>GlobalStore每秒管理75000个文件，而我的本地磁盘只有25000个文件。而且这只是在单个线程上的性能表现，这个系统设计用于高度并行访问。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/11.jpg"></p>
<p>通过使用GlobalStore替换SMB作为缓存，效果要好得多，对于典型的访问，GlobalStore比SMB共享快100倍。</p>
<p>这太棒了！但是现在我们仍然花费大量时间在每次同步后下载所有转换后的内容，而所有这些时间又是操作系统的开销……</p>
<p>【此时依旧是从GSx下载到workstation本地】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/12.jpg"></p>
<h3 id="3-2、服务器直连devkits"><a href="#3-2、服务器直连devkits" class="headerlink" title="3.2、服务器直连devkits"></a>3.2、服务器直连devkits</h3><p>之前的传输过程是Global Store&#x3D;&#x3D;&#x3D;&gt;workstation&#x3D;&#x3D;&#x3D;&gt;devkits</p>
<p>当游戏原始资产在workstation上被转换之后，被上传到GlobalStore，然后workstation上的一个进程告诉游戏（devkits）需要加载什么内容，游戏（devkits）通过网络从Global Store加载所有内容。</p>
<p>【此处可以这样理解，当有资源修改且转换好时，直接把转换后的结果给GlobalStore，然后告诉devkits需要加载的内容，devkits直接从GlobalStore加载，这样的好处是，其他的devkits也可以从GlobalStore加载到最新的内容。】</p>
<p>这一台服务器为所有devkits、workstations和build machine提供数据，使用这样的方式，不需要从Global Store拉取到workstation，再通过网络传输给devkits，而是由Global Store直接传输给devkits，这样的方式让加载速度提高10-20%。</p>
<p>【此处应该是因为不需要把内容写到磁盘中直接通过网络传输，以及网络传输的速度更快】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/13.jpg"></p>
<p>对于《Horizon Forbidden West》，他们搭建了一台单独的服务器（Global Store），拥有768GB的内存、14TB的存储空间和80Gbps的网络，为大约350人提供服务，他们可以不用将所有转换后的内容复制到每个devkits和workstation上。</p>
<p>到这一步，他们有了一个Global Store，所有数据都从中央服务器流式传输，加载本地游戏版本与加载任何其他构建版本没有任何区别。</p>
<p>【因为都是使用的网络传输加载文件】</p>
<p>一个构建版本由许多资源组成，每个资源都映射到GlobalStore中的转换结果，通过为构建中的所有资源创建一个单一映射，并将该映射本身上传到GlobalStore中，我们只需要一个单一标识符就可以引用整个构建。</p>
<p>【比如版本1，映射表{资源1:a, 资源2:b,}，版本2，映射表{资源1:a2，资源2:b}，一个版本一个标识符，可以直接快速拉取，这其实有点类似我们的根据分支名拉取对应的版本。只不过我们每一个版本都包含完整的所有内容，他这里的资源都是按照结果缓存的，复用度很高。】</p>
<p>演讲中他们举了一个例子，Level启动器（Level Launcher），假设你想将你所做的更改与没有你的更改的相同版本进行比较，您将打开构建列表，选择您同步到的版本，并点击启动，启动器首先下载可执行文件，然后启动游戏，您还可以选择今天早上或上周的构建版本，或者是同事正在进行的工作，他们可以通过一个简单的链接与您共享，所有这些都不需要同步或还原您的任何更改，在不到20秒的时间内，我们加载的内容与您的本地状态完全不同，即20秒内就能加载一个完全不同的版本。</p>
<p>【这个地方其实感觉没有特别的方便，因为也是需要一个唯一标识符，然后拉取启动器，然后启动游戏，最大的优势应该就是快，因为不需要下载几十G的资源，到本地，再启动文件，前文提到了，磁盘读写巨慢。不过人家是主机游戏，有独特的难点】</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/14.jpg"></p>
<p>演讲者又举了一个例子，使用Global Store系统，他们能够分发我们的光烘焙（light bakes）任务，我们可以让整个办公室内的每个空闲工作站在几分钟内加载到相同版本的游戏中。</p>
<p>光烘焙是一个昂贵的过程，需要运行完整的游戏逻辑，包括GPU渲染，以前，他们有专门的build machine，build machine会同步到特定的版本，然后开始冗长的烘焙过程，这给服务器群组带来了巨大的压力。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/15.jpg"></p>
<p>在夜间有很多空闲的workstation，但是改变他人workstation上的工作环境又是很麻烦的事情。【你要清除本地修改，切换版本，任务结束还要还原回来】</p>
<p>因此，通过GlobalStore流式传输，可以将单个可执行文件放在他们的计算机上，它会简单地将所有内容流式传输，而无需更改他们的本地状态。</p>
<p>这使得能够在所有空闲的工作站上分发光烘焙，确保它们正在烘焙完全相同的事物而不更改用户的状态，这释放了大量的计算能力。</p>
<p>通过从庞大的软件包转向细粒度内容加载，我们极大地改善了迭代时间,而且，通过不再在每个开发工具包或工作站上存储重复数据，而是通过网络流式传输所有内容，我们将游戏的大小与您处理的数据解耦了。</p>
<p>加载自己的本地更改、上周的构建版本或同事分享的原型都一样快，这使得完全新的工作流程成为可能。</p>
<p>现在拥有一个内容加载系统，它从高性能的Key-Value Store中流式传输所有内容。</p>
<p>正如我之前提到的，我们将转换后的内容存储在GlobalStore中，但这只是可以缓存的内容之一。</p>
<p>他们还存储了来自build machine的可执行文件，因此他们不需要将它们放入到Perforce中。</p>
<p>一个很好的例子是AssetIndexer，它从游戏资产中的文件构建起自己的数据库，为了做到这一点，它需要一次性读取并解析所有数百万个文件，以提取索引数据,但是是workstation都需要进行这个过程，除了一小部分本地更改外，它们都在解析完全相同的文件。</p>
<p>他们将每个文件的摘要存储在Global Store中，并以元数据（文件路径、文件大小和修改时间）为key，AssetIndexer可以通过仅列出文件以获取元数据并从Global Store下载摘要来构建其数据库，甚至无需打开任何文件。</p>
<p>由于GlobalStore针对数以百万计的小请求进行了优化，这比读取和解析文件本身要快得多。这意味着我们可以在大约5分钟内构建出游戏中每个文件的数据库，而无需打开任何文件。</p>
<p>再举一个例子，比如加载像Agent实体这样的东西时，还需要加载它的网格、纹理、动画等。</p>
<p>这些可能存储在单独的CoreText或二进制文件中，因此要在Global Store中找到所有这些文件的转换结果，转换过程会递归地跟踪对象和文件之间的链接，创建需要加载的图形，这是一个依赖检查的过程。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/16.jpg"></p>
<p>以前需要通过从磁盘中读取文件以确定链接结构，并计算哈希值进行比较，这样的方式意味着现在每次游戏尝试加载某些内容时都要打开成千上万个文件。</p>
<p>但是有了AssetIndexer，我们已经在内存映射数据库中拥有了所有这些数据。【Asset Indexer，一个Local Database】</p>
<p>打开许多文件的问题在于，对于每个文件，您需要进行一次内核调用来获取句柄，然后再进行一次内核调用来关闭它。即使没有任何其他磁盘访问，CPU每个文件都需要在内核模式和用户模式之间进行两次切换。</p>
<p>文件系统还必须提供关于进程之间文件一致性的保证，因此大多数调用会在内部锁上进行序列化处理。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/17.jpg"></p>
<p>对于我们的shadred memory，我们只需要进行一次内核调用，将Asset Indexer数据库映射到转换工具的进程空间中，然后再进行一次调用来获取对其的读取锁。</p>
<p>通过这两次内核调用，我们现在可以像处理内存中的任何其他数据一样访问关于所有400万个文件的索引信息。</p>
<p>在映射完成后，查找文件的哈希值只需要1.2微秒。</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/18.jpg"></p>
<p>使用Shared Memory，我们每秒可以查找70万个哈希值。与我们之前的数字进行比较：</p>
<p>• 网络共享每秒处理700个文件，这在图表上甚至不可见。</p>
<p>• NTFS文件系统每秒处理2.5万个文件。</p>
<p>• GlobalStore每秒处理7.5万个文件。</p>
<p>但情况变得更好！这仅仅是单线程的速度。</p>
<p>在持有只读锁的同时，Asset Indexer可以完美地扩展到并行操作。将其分布到16个核心上，我可以达到每秒1300万个文件。这意味着我们可以在1&#x2F;3秒内查找游戏中每个文件的哈希值。相比之下，仅仅打开这些文件就需要花费2.5分钟的时间。</p>
<p>当我提到内存映射数据库时，并不仅仅是将SQLite文件进行内存映射并对其执行查询，该数据库是一个实际的数据结构，专为我们的内容设计。</p>
<p>文件和对象分别存储在不同的表中以实现高效存储，但在数据结构中导航的性能仍然非常高。</p>
<p>文件的条目直接索引到对象表，指向包含该文件对象的连续行。</p>
<p>无需运行复杂的查询或迭代遍历所有行来查找相关数据，对于链接也是如此。</p>
<h1 id="三、虚拟文件系统"><a href="#三、虚拟文件系统" class="headerlink" title="三、虚拟文件系统"></a>三、虚拟文件系统</h1><p>使用Asset Indexer，我们可以建立链接图，比较哈希值，并进行其他一些检查，在40秒内就可以知道游戏中所有100万个CoreText文件是否已被转换。</p>
<p>通过切换到Asset Indexer进行依赖检查，整个过程变得显着更快。</p>
<p>但可能更重要的是，我们可以在加载游戏时无需从磁盘读取任何一个CoreText文件，直接从Global Store中流式传输已转换的内容，这在以后将变得更加重要。</p>
<p>因为几乎正好在3年前的2020年3月，因为新冠的原因，大家都居家办公，然而Asset Indexer+Global Store是针对办公网络而制定的，办公网络是10Gbps，并且每个workstation的延迟小于1毫秒。</p>
<p>如果在家中使用这套系统，在最糟糕的情况下通过20Mbps的连接进行工作，比办公网络的速度慢500倍，在这样的连接上下载一个95GB的软件包将需要整整一天的工作时间。</p>
<p>然后他们只能在每台远程工作的电脑上设置了GlobalStore代理。【你可以理解为GlobalStore中心服务器的本地版本，为了解决网络糟糕的问题】</p>
<p>一个本地的GlobalStore Proxy，意味着回到了每个workstation都包含需要从磁盘读取的重复数据的情况。</p>
<p>他们之前做的工作，</p>
<p>（1）通过将数据拆分为较小的块。</p>
<p>（2）仅加载所需内容。</p>
<p>（3）在获取最新版本之后，他们只需下载自上次同步以来已转换内容的增量，并且仅在他们正在工作的区域下载，并且GlobalStore Proxy对于这些小请求实现了比网络文件共享更高的吞吐量。</p>
<p>但即使有了这些设计，他们依旧遇到了很大的问题，就是从Perforce同步游戏资产，用户每天都需要下载10-40GB的内容，而且其中大部分实际上并不被该用户使用。</p>
<p>此时，他们选择了Virtual File System，简而言之，对于用户或任何程序来说，文件似乎存在，但只有当实际读取文件时才会下载内容。</p>
<p>通过将Virtual File System与AssetIndexer和Global Store相结合，我们可以在没有任何内容存储在磁盘上的情况下开始进行游戏开发。只有在需要时才会按需下载所需的内容。</p>
<p>为了将所有这些组合起来，来看一下文件的生命周期。</p>
<p>（1）文件的生命周期从某人将文件提交到Perforce开始，提交之后，这个文件就真实的存在在Perforce中。</p>
<p>（2）其他人使用时后，则是通过Virtual File System+Perfoce同步该文件，此时不会真正的获取完整的文件，而只是获取文件的meta data。</p>
<p>Perforce提供了足够的元数据，使虚拟文件系统可以假装文件已经存在。</p>
<p>（3）本地数据库Asset Indexer发现了这个新文件，并基于meta data从Global Store中获取包含Object、UUID、reference等信息。</p>
<p>（4）用户在编辑器中打开Asset Browser，Asset Browser向Asset Indexer请求对象列表，该列表现在包括新文件。</p>
<p>（5）如果用户打开文件，Virtual File System会按需从Perforce获取完整内容。</p>
<p>（6）用户可以进行一些编辑，在保存时，Asset Indexer重新扫描带有新更改的文件。</p>
<p>（7）为了测试更改，用户启动游戏，这也会启动一个转换过程。它向Asset Indexer请求磁盘的状态，注意到还有尚未转换的本地更改，Asset Indexer将其转换并上传到Global Store。 （8）最后，游戏会流式传输这些新的资产。</p>
<p>（9）满意自己的更改后，用户将文件提交回Source Control，完成了整个循环。</p>
<p>整个过程如下图，从Perforce开始，然后时VFS，然后是Asset Indexer，Global Store，最后回到Perforce</p>
<p><img src="/images/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/19.jpg"></p>
<p>由于这个系统，同步内容和在新分支上启动游戏不再需要超过8个小时，而只需要20分钟。</p>
<p>而且，由于不再需要所有游戏资产和转换后的内容，您可以轻松地同步多个分支，而不会耗尽存储空间，因此在项目之间切换只需要几秒钟。</p>
<h1 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h1><p>整个演讲中提到了三个工具</p>
<p>（1）Asset Indexer，应该可以理解为Guerrilla工作室根据他们的数据类型CoreText，自定义的一个游戏资产数据库，使用这个数据库可以很方便的实现Asset Browser和Asset Reference Viewer的功能，并且由于使用了CoreText作为描述文件，数据量大大减少，可以全部存放在内存中，加快了查询和使用的速度。</p>
<p>（2）Global Store，可以理解为是一个自定义的网络共享服务器，使用key-value的方式存储内容，对于小文件的获取非常的方便，使用Global Store还存储了每个版本的文件，可以给所有的build machine、devkits使用。</p>
<p>Global Store+网络文件传输的结合让他们减少了workstation的磁盘空间占用问题，同时能够在不影响workstation本地环境的情况下，快速的一个工作环境，这样的优势让他们能给每一个workstation发布烘焙这样的任务</p>
<p>（3）Virtual File System，虚拟文件系统，利用虚拟文件系统的特性，可以在同步的时候仅同步真正会使用到的资产，减少资产同步的代价。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://qinhaifu.github.io">仲谨(haifu_qin@163.com)</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://qinhaifu.github.io/2024/05/26/GDC/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/">http://qinhaifu.github.io/2024/05/26/GDC/Scaling-Tools-for-Millions-of-Assets-for-Horizon-Forbidden-West/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/GDC2023/">GDC2023</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/07/Python/%E4%B8%8D%E5%90%8C%E7%9A%84python%20import%20%E6%96%B9%E5%BC%8F%E5%AF%BC%E8%87%B4%E7%9A%84reload%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" title="不同的python import 方式导致的reload踩坑记录"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">不同的python import 方式导致的reload踩坑记录</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/26/Game_Programming_Patterns/%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/" title="游戏编程模式-命令模式"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">游戏编程模式-命令模式</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">仲谨(haifu_qin@163.com)</div><div class="author-info__description">一个游戏爱好者，一个游戏开发程序员</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Qinhaifu"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">不定期更新博客，大部分是技术文章，会有少量随笔闲聊，欢迎大家关注！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Asset-DataBase%EF%BC%88%E8%B5%84%E4%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">一、Asset DataBase（资产数据库）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%83%8C%E6%99%AF"><span class="toc-number">1.1.</span> <span class="toc-text">1、背景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81Asset-Browser%EF%BC%88%E8%B5%84%E6%BA%90%E6%90%9C%E7%B4%A2%E3%80%81%E8%BF%87%E6%BB%A4%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1、Asset Browser（资源搜索、过滤）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81Reference-Viewer%EF%BC%88%E8%B5%84%E6%BA%90%E5%BC%95%E7%94%A8%E5%85%B3%E7%B3%BB%E6%9F%A5%E7%9C%8B%EF%BC%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2、Reference Viewer（资源引用关系查看）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Asset-Indexer"><span class="toc-number">1.2.</span> <span class="toc-text">2、Asset Indexer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81Asset-Indexer%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1、Asset Indexer简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81Asset-Indexer%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E7%AE%80%E4%BB%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2、Asset Indexer实现方式简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.2、总结一下</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%86%85%E5%AE%B9%E5%8A%A0%E8%BD%BD%EF%BC%88Content-Loading%EF%BC%89GlobalStore"><span class="toc-number">2.</span> <span class="toc-text">二、内容加载（Content Loading）GlobalStore</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%8B%86%E5%88%86%E6%95%B4%E5%8C%85"><span class="toc-number">2.1.</span> <span class="toc-text">1、拆分整包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%BC%93%E5%AD%98%E8%BD%AC%E6%8D%A2%E7%BB%93%E6%9E%9C%EF%BC%8C%E7%BD%91%E7%BB%9C%E5%85%B1%E4%BA%AB"><span class="toc-number">2.2.</span> <span class="toc-text">2、缓存转换结果，网络共享</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81GlobalStore%E6%9B%BF%E4%BB%A3SMB%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">3、GlobalStore替代SMB共享服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81%E6%9B%BF%E6%8D%A2%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.1、替换服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%B4%E8%BF%9Edevkits"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.2、服务器直连devkits</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%99%9A%E6%8B%9F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">3.</span> <span class="toc-text">三、虚拟文件系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">四、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/02/MiscellaneousNotes/%E5%B0%9D%E8%AF%95%E8%87%AA%E5%B7%B1%E5%81%9A%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E9%A1%B9%E7%9B%AE/" title="尝试自己做一个完整的项目">尝试自己做一个完整的项目</a><time datetime="2025-06-02T02:00:00.000Z" title="Created 2025-06-02 10:00:00">2025-06-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/23/Aseprite/Aseprite%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E8%AE%B0%E5%BD%95/" title="Aseprite源码编译踩坑记录">Aseprite源码编译踩坑记录</a><time datetime="2025-02-23T02:00:00.000Z" title="Created 2025-02-23 10:00:00">2025-02-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/23/BlogMnagerDirection/blog%E6%9B%B4%E6%96%B0%E6%96%B9%E5%BC%8F/" title="blog更新管理方式">blog更新管理方式</a><time datetime="2025-02-23T01:00:00.000Z" title="Created 2025-02-23 09:00:00">2025-02-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/07/Python/%E6%9C%89co_freevars%E6%97%B6%E5%A6%82%E4%BD%95%E6%9B%BF%E6%8D%A2PyCodeObject/" title="如何替换含有co_freevars的PyCodeObject">如何替换含有co_freevars的PyCodeObject</a><time datetime="2024-07-07T05:00:00.000Z" title="Created 2024-07-07 13:00:00">2024-07-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/07/Python/%E4%B8%8D%E5%90%8C%E7%9A%84python%20import%20%E6%96%B9%E5%BC%8F%E5%AF%BC%E8%87%B4%E7%9A%84reload%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" title="不同的python import 方式导致的reload踩坑记录">不同的python import 方式导致的reload踩坑记录</a><time datetime="2024-07-07T05:00:00.000Z" title="Created 2024-07-07 13:00:00">2024-07-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By 仲谨(haifu_qin@163.com)</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const loadUtterances = () => {
    let ele = document.createElement('script')
    ele.id = 'utterances_comment'
    ele.src = 'https://utteranc.es/client.js'
    ele.setAttribute('repo', 'Qinhaifu/QinHaiFu.github.io')
    ele.setAttribute('issue-term', 'pathname')
    const nowTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'photon-dark' : 'github-light'
    ele.setAttribute('theme', nowTheme)
    ele.crossOrigin = 'anonymous'
    ele.async = true
    document.getElementById('utterances-wrap').appendChild(ele)
  }

  const utterancesTheme = theme => {
    const iframe = document.querySelector('.utterances-frame')
    if (iframe) {
      const theme = theme === 'dark' ? 'photon-dark' : 'github-light'
      const message = {
        type: 'set-theme',
        theme: theme
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es');
    }
  }

  btf.addGlobalFn('themeChange', utterancesTheme, 'utterances')

  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>